(function(b,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],f):(b=typeof globalThis<"u"?globalThis:b||self,f(b.VuePlugin={},b.Vue))})(this,function(b,f){var K,G,$,R,X,Y,Z,Q,tt,nt,bt,et,U,st,J,z;"use strict";var ut=(b,f,C)=>{if(!f.has(b))throw TypeError("Cannot "+C)};var m=(b,f,C)=>(ut(b,f,"read from private field"),C?C.call(b):f.get(b)),S=(b,f,C)=>{if(f.has(b))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(b):f.set(b,C)},I=(b,f,C,H)=>(ut(b,f,"write to private field"),H?H.call(b,C):f.set(b,C),C);var wt=(b,f,C)=>(ut(b,f,"access private method"),C);const C="&lt;",H="&gt;",ot="/";class Tt{constructor(t,s=!1){S(this,nt);S(this,K,[]);S(this,G,"");S(this,$,"");S(this,R,[]);S(this,X,[]);S(this,Y,[]);S(this,Z,[]);S(this,Q,[]);S(this,tt,[]);I(this,G,t.trim()),I(this,$,`${m(this,G)}
<Eof />`),this.protect(),s&&this.markupQuotes(),this.collectWords(m(this,$)),this.makeMistakes()}get list(){return m(this,K)}get text(){return m(this,G)}get workingText(){return m(this,$)}get words(){return m(this,R)}get mistakes(){return m(this,Q)}get mistakeCursors(){return m(this,tt)}get phraseStarts(){return m(this,X)}get phraseLengths(){return m(this,Y)}get wordEnds(){return m(this,Z)}translateBracket(t,s,i=!1){let n=t,r=!1;return"CDETQRG".includes(s)&&(s==="C"&&(n=i?")":"(",r=!0),s==="D"&&(n=i?"}}":"{{",r=!0),s==="E"&&(n=i?"}":"{",r=!0),s==="T"&&(n=i?"]":"[",r=!0),s==="Q"&&(n="'",r=!0),s==="R"&&(n='"',r=!0),s==="G"&&(n="`",r=!0)),{word:n,translated:r}}markupQuotes(){let t=m(this,$);const s=/(["'`])((\s|((\\)*)\\.|.)*?)\1/gm;let i;const n=[];for(;(i=s.exec(t))!==null;)i.index===s.lastIndex&&s.lastIndex++,n.push(i);for(let r=n.length-1;r>-1;r--){const d=n[r],a=d[1],u=d[0];let e=d[2];const h=d.index+1,c=h+u.length-1;let p="";a==='"'?p="R":a==="'"?p="Q":a==="`"&&(p="G"),e=e.replace(/&lt;/g,"&pp;"),e=e.replace(/&gt;/g,"&pg;");const x=`&oq;${p}&cq;${e}&oq;/${p}&cq;`,A=t.substring(0,h-1),g=t.substring(c);t=A+x+g}I(this,$,t)}doAttributes(t){const s={},i=/([\w]*)(\[\])?=("([\S ][^"]*)"|'([\S]*)'|\{\{ ([\w]*) \}\}|\{([\S ]*)\})/gm;let n;const r=[];for(;(n=i.exec(t))!==null;)n.index===i.lastIndex&&i.lastIndex++,r.push(n);for(let d=0;d<r.length;d++){const a=r[d],u=a[1],e=a[2],h=a[3].substring(0,1),c=a[4];e==="[]"?(s[u]===void 0&&(s[u]=[]),s[u].push(h+c)):s[u]=`${h}${c}`}return s}isClosedTag(t){let s=!1;const{text:i}=t;return i===""||(s=i.substring(i.length-5,i.length)===ot+H),s}isCloserTag(t){let s=!1;const{text:i}=t;return i===""||(s=i.substring(0,5)===C+ot),s}makeTag(t,s,i,n,r=!1){const{text:d}=t,{name:a}=t,u=this.list.length,e={};return e.id=t.id,e.name=a===""?"Fragment":a,e.text=d,e.startsAt=t.startsAt,e.endsAt=t.endsAt,r||(e.uid=wt(this,nt,bt),e.method="echo",e.props=e.name==="Fragment"?[]:[],e.depth=i,e.hasCloser=n,e.node=!1,e.isSingle=!1),(s[i]===void 0||s[i]===null)&&(s[i]=u-1),e.parentId=s[i],e}protect(){let t=m(this,$);t=t.trim(),t=t.replace(/\{\{/g,"<D>"),t=t.replace(/\}\}/g,"</D>"),t=t.replace(/\(/g,"<C>"),t=t.replace(/\)/g,"</C>"),t=t.replace(/\{/g,"<E>"),t=t.replace(/\}/g,"</E>"),t=t.replace(/\[/g,"<T>"),t=t.replace(/\]/g,"</T>"),t=t.replace(/<([/\w])/g,`${C}$1`),t=t.replace(/>/g,H),I(this,$,t)}collectTags(t,s="[\\w]+"){const i=[],n=[],r=`${C}\\/?(${s})((\\s|.*?)*?)\\/?${H}`,d=new RegExp(r,"gm");let a;for(;(a=d.exec(t))!==null;)a.index===d.lastIndex&&d.lastIndex++,n.push(a);let u=0;return n.forEach(e=>{const h=e;h.id=u,h.text=e[0],h.name=e[1]===null?"Fragment":e[1],h.startsAt=e.index,h.endsAt=e.index+h.text.length-1,delete h[0],delete h[1],delete h[2],delete h[3],i.push(h),u++}),i}collectWords(t){const s=[],i=[];let n=/([&oqpg;]{4})[\w /]+([&cqpp;]{4})/gm,r;for(;(r=n.exec(t))!==null;)r.index===n.lastIndex&&n.lastIndex++,i.push(r);let d=t;for(let a=i.length-1;a>-1;a--){const u=i[a][0],e=i[a].index+1,h=e+u.length-1,c="•".repeat(u.length),p=d.substring(0,e-1),x=d.substring(h);d=p+c+x}for(n=/([&lt;]{4})[\w /]+([&gt;]{4})/gm;(r=n.exec(d))!==null;)r.index===n.lastIndex&&n.lastIndex++,i.push(r);for(let a=i.length-1;a>-1;a--){const u=i[a][0],e=i[a].index+1,h=e+u.length-1,c="•".repeat(u.length),p=d.substring(0,e-1),x=d.substring(h);d=p+c+x}for(n=/([&ltgt;]{4})/gm;(r=n.exec(d))!==null;)r.index===n.lastIndex&&n.lastIndex++,i.push(r);for(let a=i.length-1;a>-1;a--){const u=i[a][0],e=i[a].index+1,h=e+u.length-1,c="•".repeat(u.length),p=d.substring(0,e-1),x=d.substring(h);d=p+c+x}for(n=/((?!•)\S[^•\n]*)/g;(r=n.exec(d))!==null;)r.index===n.lastIndex&&n.lastIndex++,m(this,X).push(r.index),m(this,Y).push(r[0].length);for(n=/((?!•)\S[^•\n ]*)/g;(r=n.exec(d))!==null;){r.index===n.lastIndex&&n.lastIndex++;const a={};a.text=r[0],a.startsAt=r.index,a.endsAt=a.startsAt+r[0].length-1,s.push(a),m(this,Z).push(a.endsAt)}I(this,R,s)}makeMistakes(){let t=Math.ceil(Math.random()*2)-2;const s=Math.ceil(Math.random()*3)+2;m(this,R).forEach(i=>{if(t++,t%s!==0||i.text.length<4)return;const n=Math.ceil(Math.random()*i.text.length)-1,r=String.fromCharCode(Math.ceil(Math.random()*26)+96);m(this,tt).push(i.startsAt+n),m(this,Q).push(r)})}makeFaultyText(){let t=m(this,$);m(this,Q).forEach(s=>{const i=t.substring(0,s.startsAt),n=t.substring(s.endsAt+1);t=i+s.text+n}),I(this,$,t)}splitTags(t){let s=[...t],i=s.length,n=0,r=!1,d=0;const a=i;let u=!1;const e=[],h=[];for(;s.length>0&&!r&&!u;){if(n===i){if(n=0,s=Object.values(s),i=s.length,i===0){r=!0;continue}d++,u=d>a+1}const c=s[n];if(s.length===1&&c.name==="Eof"){r=!0;continue}if(this.isClosedTag(c)&&c.name!=="Eof"){h[n]=s[n],delete s[n],n++;continue}if(n+1<i){const p=s[n+1];if(!this.isCloserTag(c)&&this.isCloserTag(p)){if(c.name!==p.name){e.push(c),delete s[n],n++;continue}h[n]=s[n],h[n+1]=s[n+1],delete s[n],delete s[n+1],n+=2;continue}}n++}return{regularTags:h,singleTags:e}}replaceTags(t,s){let i=t,n=s;const r=[];s.forEach(d=>{r[d.id]=d}),r.sort(),n=Object.values(r);for(let d=n.length-1;d>-1;d--){const a=n[d];a.text=a.text.substring(0,a.text.length-4)+ot+H;const u=i.substring(0,a.startsAt),e=i.substring(a.endsAt+1);i=u+a.text+e}return i}doComponents(t="[\\w]+"){let s=m(this,$);const i=this.collectTags(s,t),n=[];let r=[],d=0;const a=[];let u=i.length,e=0,h=!1,c=0;const p=u;let x=!1;a[d]=-1;const{singleTags:A}=this.splitTags(i);let g=i;for(A.length&&(A.forEach(T=>n.push(T.id)),s=this.replaceTags(s,A),g=this.collectTags(s,t));g.length>0&&!h&&!x;){if(e===u){if(e=0,g=Object.values(g),u=g.length,u===0){h=!0;continue}c++,x=c>p+1}const T=g[e];if(g.length===1&&T.name==="Eof"){h=!0;continue}if(this.isClosedTag(T)&&T.name!=="Eof"){const j=this.makeTag(T,a,d,!1);j.isSingle=n.includes(T.id),r[j.id]=j,delete g[e],e++;continue}if(this.isCloserTag(T)&&d--,e+1<u){const j=g[e+1];if(!this.isCloserTag(T)&&this.isCloserTag(j)){const q=this.makeTag(T,a,d,!0),v=this.makeTag(j,a,d,!1,!0);v.contents={},v.parentId=q.id,v.contents.startsAt=q.endsAt+1,v.contents.endsAt=v.startsAt;const rt=s.substring(v.contents.startsAt,v.contents.endsAt);v.contents.text=rt,q.closer=v,r[q.id]=q,delete g[e],delete g[e+1],e+=2;continue}!this.isCloserTag(T)&&!this.isCloserTag(j)&&(d++,a[d]=T.id)}e++}r=Object.values(r),I(this,$,s),I(this,K,r)}}K=new WeakMap,G=new WeakMap,$=new WeakMap,R=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,Q=new WeakMap,tt=new WeakMap,nt=new WeakSet,bt=function(){return Date.now()*Math.random()};const L="&lt;",M="&gt;",B="<",F=">",V="/",N=`
`;class dt{constructor(t,s,i,n,r){S(this,et,"");S(this,U,60);S(this,st,!1);S(this,J,()=>{});S(this,z,()=>{});I(this,J,t),I(this,et,s),I(this,U,i),I(this,z,r),I(this,st,n)}async writeLikeAHuman(t,s){const i=s!==void 0,n=m(this,J).querySelector(`pre#${s} code`),r=m(this,J).querySelector(i?`pre#${t} code`:`div#${t}`);let d=m(this,U),a=[],u="",e="",h="",c=null,p=[];const x=[];let A="",g="",T=-1;const j=[],q=[];let v=0,rt=this;function gt(l){return new Promise(o=>{setTimeout(o,l)})}function Mt(l){return Math.floor(l*.75+Math.random()*l)}async function _(l,o=!1){let y=a.join("");o&&(y=y.trim()),d=Mt(m(rt,U)),u+=l,r.innerHTML=u+y,i&&window.hljs!==void 0&&window.hljs.highlightElement(r),await gt(d)}async function jt(){const l=a.join("");u=u.substring(0,u.length-1),r.innerHTML=u+l,await gt(d)}function W(l){a.unshift(l)}function it(){delete a[0],a=Object.values(a)}function Dt(l){const o=[],y=/^([^\S][ \s]+)*/gm;let D;for(;(D=y.exec(l))!==null;)D.index===y.lastIndex&&y.lastIndex++,o.push(D[0]??"");return o}function Bt(l){const o=/^([^\S][ \s]+)*/gm;return l.replace(o,"")}function Nt(l){const o=l.split(`
`);return`<br />
`.repeat(o.length)}async function qt(l){let o="";return await fetch(l).then(y=>y.text()).then(y=>{o=y}),o}function Ht(l){return l.replaceAll(L,B).replaceAll(M,F)}function Ft(){let l=null;return p.length&&(l=p.shift(),l.hasCloser&&x.push(l)),l}function Vt(){return x.length?x[x.length-1]:null}function Wt(){if(!j.length)return null;const l=j.pop(),o=q.pop();W(o?N+e+l:l)}function pt(l){let o=null;if(!x.length||(o=Vt(),l===o.depth))return o;let y=!1;for(let D=x.length-1;D>-1;D--)if(o=x[D],l===o.depth){y=!0;break}return y?o:null}const Pt=m(this,et);A=await qt(Pt);const mt=Dt(A);A=Bt(A);const k=new Tt(A,i);if(k.doComponents(),p=[...k.list],g=k.workingText.replace(`${N+L}Eof ${V}${M}`,""),i){console.log({sourceComponent:n});const l=Nt(A+`
`);console.log({emptyText:l}),n.innerHTML=l,window.hljs!==void 0&&window.hljs.highlightElement(n)}const Gt=mt[v]??"";await _(Gt),v++;for(let l=0;l<g.length;l++){let o=g[l];if(i&&o===B){o=L,await _(o);continue}if(m(this,st)&&k.mistakes.length&&k.phraseStarts.length&&k.phraseStarts[0]===l){const E=k.phraseLengths[0];for(let w=0;w<E;w++){const P=l+w,at=k.mistakeCursors[0];if(o=g[P],at===P?await _(k.mistakes[0]):await _(o),k.wordEnds.includes(P)&&k.mistakeCursors.length){const lt=k.mistakeCursors[0];if(lt<=P){const ct=P-lt+1;for(let xt=0;xt<ct;xt++)await jt(),w--;k.mistakes.shift(),k.mistakeCursors.shift()}}}k.phraseStarts.shift(),k.phraseLengths.shift(),l+=E-1;continue}const y=g.substring(l,l+4),D=g.substring(l,l+5);if(o==="&"&&D==="&oq;/"){const E=g.substring(l+5,l+6),{word:w}=k.translateBracket(o,E);it(),await _(w),l+=9;continue}if(o==="&"&&y==="&oq;"){const E=g.substring(l+4,l+5),{word:w}=k.translateBracket(o,E);W(w),await _(w),l+=8;continue}if(o==="&"&&y==="&pp;"){l+=3,await _(L);continue}if(o==="&"&&y==="&pg;"){l+=3,await _(M);continue}if(i){if(o==="/"&&D===V+M&&c!==null&&!c.hasCloser&&c.endsAt===l+4){o=V+M,it(),await _(o),l+=4;continue}if(o==="&"&&y===M&&c!==null&&c.endsAt===l+3){it(),await _(M),c.hasCloser&&Wt(),l+=3;continue}}if(o==="&"&&D===L+V){c=pt(T),c===null&&T-1>-1&&(c=pt(T-1)),o=c.closer.text,i||(o=B+V+c.closer.name+F);const{word:E}=k.translateBracket(o,c.name,!0);if(o=E,o!==""){it(),l=c.closer.endsAt,await _(o),T--,c=null;continue}}if(o==="&"&&y!==L){const E=g.substring(l).indexOf(";");if(E>8){await _(o);continue}const w=g.substring(l,l+E+1);await _(w),l+=w.length-1;continue}if(o==="&"&&y===L){if((c===null||c!==null&&c.dirty)&&(c=Ft()),c.startsAt!==l){i?(o=L,l+=3):(o=c.text.replace(L,B),o=o.replace(M,F)),await _(o),c.dirty=!1;continue}c.dirty=!0;let E=!1,w="";o=c.text,i||(o=c.text.replace(L,B),o=o.replace(M,F));const{word:P,translated:at}=k.translateBracket(o,c.name);if(o=P,c.hasCloser){T++,w=c.closer.text,i||(w=B+V+c.closer.name+F);const{word:lt,translated:ct}=k.translateBracket(w,c.name,!0);w=lt,E=c.closer.contents.text.indexOf(N)>-1,ct?(l=c.endsAt,W(E?N+e+w:w)):(j.push(w),q.push(E))}at||(E=c.text.indexOf(N)>-1,i?(o=L,l+=3,w=M):(o=c.text.replace(L,B),o=o.replace(M,F),l+=c.text.length-1,w=B+V+c.closer.name+F),W(E?N+e+w:w)),await _(o);continue}if(o===N){e=mt[v]??"",h=N+e;const E=a.length?a[0].trim():"",w=g.substring(l+1,l+E.length+1);v++,await _(h,E===w);continue}await _(o)}u=Ht(u),this.finishedEvent(u)}finishedEvent(t){typeof m(this,z)=="function"&&m(this,z).call(this,t)}}et=new WeakMap,U=new WeakMap,st=new WeakMap,J=new WeakMap,z=new WeakMap;const Rt="",kt={class:"to-be-copied"},yt=["id"],Et=[f.createElementVNode("code",null,null,-1)],At={class:"to-be-written"},_t=["id"],Ct=[f.createElementVNode("code",null,null,-1)],St=f.defineComponent({name:"CodeWriter"}),ht=Object.assign(St,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1},useHighlightJs:{default:!1},theme:{default:"base16/monokai"},language:{default:"html"}},setup(O){const t=O,s=f.ref(null),i=f.ref(""),n=f.ref(""),r=f.ref(""),d=()=>{let e=Date.now().toString();return e=e.substring(e.length-4),e=btoa(e),e=e.replace(/=/g,""),e};i.value=d(),n.value="to-copy-"+i.value,r.value="to-write-"+i.value,f.onMounted(async()=>{const e=s.value.ownerDocument;if(t.useHighlightJs){const h=t.theme??"base16/monokai",c=t.language??"html",p=e.createElement("script");p.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",e.head.appendChild(p);const x=[];x.push("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"),x.push(`https://highlightjs.org/static/demo/styles/${h}.css`),x.forEach(g=>{const T=e.createElement("style");T.innerHTML=`@import "${g}"`,e.head.appendChild(T)});const A=e.querySelectorAll("code");for(const g of A)g.setAttribute("class",`language-${c}`)}if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(p=>{const x=e.createElement("style");x.innerHTML=`@import "${p}"`,e.head.appendChild(x)}),e.getElementById("to-write").setAttribute("class",t.classes)),t.dependsOnSelector!==""){const h=e.querySelector(t.dependsOnSelector);if(h!==null){const c={attributes:!0};new MutationObserver(async(x,A)=>{for(const g of x)g.type==="attributes"&&g.attributeName==="finished"&&h.getAttribute("finished")==="true"&&(A.disconnect(),await u())}).observe(h,c)}}else await u()});const a=function(e){const h=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:e}});s.value.dispatchEvent(h),s.value.setAttribute("finished","true")},u=async()=>{const e=s.value.ownerDocument;await new dt(e,t.source,t.speed,t.makeTypos,a).writeLikeAHuman(r,n)};return(e,h)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:s,class:"code-snippet"},[f.createElementVNode("div",kt,[f.createElementVNode("pre",{class:"placeholder",id:n.value.value},Et,8,yt)]),f.createElementVNode("div",At,[f.createElementVNode("pre",{class:"to-write",id:r.value.value},Ct,8,_t)])],512))}}),$t={class:"to-be-written"},vt=["id"],It=f.defineComponent({name:"TextWriter"}),ft=Object.assign(It,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1}},setup(O){const t=O,s=f.ref(null),i=f.ref(""),n=f.ref(""),r=()=>{let u=Date.now().toString();return u=u.substring(u.length-4),u=btoa(u),u=u.replace(/=/g,""),u};i.value=r(),n.value="to-write-"+i.value,f.onMounted(async()=>{const u=s.value.ownerDocument;if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(c=>{const p=u.createElement("style");p.innerHTML=`@import "${c}"`,u.head.appendChild(p)}),u.getElementById("to-write").setAttribute("class",t.classes)),t.dependsOnSelector!==""){const e=u.querySelector(t.dependsOnSelector);if(e!==null){const h={attributes:!0};new MutationObserver(async(p,x)=>{for(const A of p)A.type==="attributes"&&A.attributeName==="finished"&&e.getAttribute("finished")==="true"&&(x.disconnect(),await a())}).observe(e,h)}}else await a()});const d=function(u){const e=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:u}});s.value.dispatchEvent(e),s.value.setAttribute("finished","true")},a=async()=>{const u=s.value.ownerDocument;await new dt(u,t.source,t.speed,t.makeTypos,d).writeLikeAHuman(n)};return(u,e)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:s,class:"text-snippet"},[f.createElementVNode("div",$t,[f.createElementVNode("div",{class:"to-write",id:n.value.value},null,8,vt)])],512))}}),Lt=O=>({textSpeed:O.speed,textTypos:O.makeTypos}),Ot={install(O,t){O.config.globalProperties.$writerOptions=Lt(t),O.component("text-writer",ft),O.component("code-writer",ht)}};b.CodeWriter=ht,b.TextWriter=ft,b.VueWriterPlugin=Ot,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
