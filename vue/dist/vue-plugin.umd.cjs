(function(m,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],f):(m=typeof globalThis<"u"?globalThis:m||self,f(m.VuePlugin={},m.Vue))})(this,function(m,f){var K,G,$,R,X,Y,Z,Q,tt,nt,bt,et,U,st,J,z;"use strict";var ut=(m,f,C)=>{if(!f.has(m))throw TypeError("Cannot "+C)};var g=(m,f,C)=>(ut(m,f,"read from private field"),C?C.call(m):f.get(m)),_=(m,f,C)=>{if(f.has(m))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(m):f.set(m,C)},L=(m,f,C,W)=>(ut(m,f,"write to private field"),W?W.call(m,C):f.set(m,C),C);var wt=(m,f,C)=>(ut(m,f,"access private method"),C);const C="&lt;",W="&gt;",lt="/";class Tt{constructor(t,e=!1){_(this,nt);_(this,K,[]);_(this,G,"");_(this,$,"");_(this,R,[]);_(this,X,[]);_(this,Y,[]);_(this,Z,[]);_(this,Q,[]);_(this,tt,[]);L(this,G,t.trim()),L(this,$,`${g(this,G)}
<Eof />`),this.protect(),e&&this.markupQuotes(),this.collectWords(g(this,$)),this.makeMistakes()}get list(){return g(this,K)}get text(){return g(this,G)}get workingText(){return g(this,$)}get words(){return g(this,R)}get mistakes(){return g(this,Q)}get mistakeCursors(){return g(this,tt)}get phraseStarts(){return g(this,X)}get phraseLengths(){return g(this,Y)}get wordEnds(){return g(this,Z)}translateBracket(t,e,i=!1){let n=t,s=!1;return"CDETQRG".includes(e)&&(e==="C"&&(n=i?")":"(",s=!0),e==="D"&&(n=i?"}}":"{{",s=!0),e==="E"&&(n=i?"}":"{",s=!0),e==="T"&&(n=i?"]":"[",s=!0),e==="Q"&&(n="'",s=!0),e==="R"&&(n='"',s=!0),e==="G"&&(n="`",s=!0)),{word:n,translated:s}}markupQuotes(){let t=g(this,$);const e=/(["'`])((\s|((\\)*)\\.|.)*?)\1/gm;let i;const n=[];for(;(i=e.exec(t))!==null;)i.index===e.lastIndex&&e.lastIndex++,n.push(i);for(let s=n.length-1;s>-1;s--){const l=n[s],a=l[1],d=l[0];let o=l[2];const h=l.index+1,u=h+d.length-1;let x="";a==='"'?x="R":a==="'"?x="Q":a==="`"&&(x="G"),o=o.replace(/&lt;/g,"&pp;"),o=o.replace(/&gt;/g,"&pg;");const y=`&oq;${x}&cq;${o}&oq;/${x}&cq;`,I=t.substring(0,h-1),w=t.substring(u);t=I+y+w}L(this,$,t)}doAttributes(t){const e={},i=/([\w]*)(\[\])?=("([\S ][^"]*)"|'([\S]*)'|\{\{ ([\w]*) \}\}|\{([\S ]*)\})/gm;let n;const s=[];for(;(n=i.exec(t))!==null;)n.index===i.lastIndex&&i.lastIndex++,s.push(n);for(let l=0;l<s.length;l++){const a=s[l],d=a[1],o=a[2],h=a[3].substring(0,1),u=a[4];o==="[]"?(e[d]===void 0&&(e[d]=[]),e[d].push(h+u)):e[d]=`${h}${u}`}return e}isClosedTag(t){let e=!1;const{text:i}=t;return i===""||(e=i.substring(i.length-5,i.length)===lt+W),e}isCloserTag(t){let e=!1;const{text:i}=t;return i===""||(e=i.substring(0,5)===C+lt),e}makeTag(t,e,i,n,s=!1){const{text:l}=t,{name:a}=t,d=this.list.length,o={};return o.id=t.id,o.name=a===""?"Fragment":a,o.text=l,o.startsAt=t.startsAt,o.endsAt=t.endsAt,s||(o.uid=wt(this,nt,bt),o.method="echo",o.props=o.name==="Fragment"?[]:[],o.depth=i,o.hasCloser=n,o.node=!1,o.isSingle=!1),(e[i]===void 0||e[i]===null)&&(e[i]=d-1),o.parentId=e[i],o}protect(){let t=g(this,$);t=t.trim(),t=t.replace(/\{\{/g,"<D>"),t=t.replace(/\}\}/g,"</D>"),t=t.replace(/\(/g,"<C>"),t=t.replace(/\)/g,"</C>"),t=t.replace(/\{/g,"<E>"),t=t.replace(/\}/g,"</E>"),t=t.replace(/\[/g,"<T>"),t=t.replace(/\]/g,"</T>"),t=t.replace(/<([/\w])/g,`${C}$1`),t=t.replace(/>/g,W),L(this,$,t)}collectTags(t,e="[\\w]+"){const i=[],n=[],s=`${C}\\/?(${e})((\\s|.*?)*?)\\/?${W}`,l=new RegExp(s,"gm");let a;for(;(a=l.exec(t))!==null;)a.index===l.lastIndex&&l.lastIndex++,n.push(a);let d=0;return n.forEach(o=>{const h=o;h.id=d,h.text=o[0],h.name=o[1]===null?"Fragment":o[1],h.startsAt=o.index,h.endsAt=o.index+h.text.length-1,delete h[0],delete h[1],delete h[2],delete h[3],i.push(h),d++}),i}collectWords(t){const e=[],i=[];let n=/([&oqpg;]{4})[\w /]+([&cqpp;]{4})/gm,s;for(;(s=n.exec(t))!==null;)s.index===n.lastIndex&&n.lastIndex++,i.push(s);let l=t;for(let a=i.length-1;a>-1;a--){const d=i[a][0],o=i[a].index+1,h=o+d.length-1,u="•".repeat(d.length),x=l.substring(0,o-1),y=l.substring(h);l=x+u+y}for(n=/([&lt;]{4})[\w /]+([&gt;]{4})/gm;(s=n.exec(l))!==null;)s.index===n.lastIndex&&n.lastIndex++,i.push(s);for(let a=i.length-1;a>-1;a--){const d=i[a][0],o=i[a].index+1,h=o+d.length-1,u="•".repeat(d.length),x=l.substring(0,o-1),y=l.substring(h);l=x+u+y}for(n=/([&ltgt;]{4})/gm;(s=n.exec(l))!==null;)s.index===n.lastIndex&&n.lastIndex++,i.push(s);for(let a=i.length-1;a>-1;a--){const d=i[a][0],o=i[a].index+1,h=o+d.length-1,u="•".repeat(d.length),x=l.substring(0,o-1),y=l.substring(h);l=x+u+y}for(n=/((?!•)\S[^•\n]*)/g;(s=n.exec(l))!==null;)s.index===n.lastIndex&&n.lastIndex++,g(this,X).push(s.index),g(this,Y).push(s[0].length);for(n=/((?!•)\S[^•\n ]*)/g;(s=n.exec(l))!==null;){s.index===n.lastIndex&&n.lastIndex++;const a={};a.text=s[0],a.startsAt=s.index,a.endsAt=a.startsAt+s[0].length-1,e.push(a),g(this,Z).push(a.endsAt)}L(this,R,e)}makeMistakes(){let t=Math.ceil(Math.random()*2)-2;const e=Math.ceil(Math.random()*3)+2;g(this,R).forEach(i=>{if(t++,t%e!==0||i.text.length<4)return;const n=Math.ceil(Math.random()*i.text.length)-1,s=String.fromCharCode(Math.ceil(Math.random()*26)+96);g(this,tt).push(i.startsAt+n),g(this,Q).push(s)})}makeFaultyText(){let t=g(this,$);g(this,Q).forEach(e=>{const i=t.substring(0,e.startsAt),n=t.substring(e.endsAt+1);t=i+e.text+n}),L(this,$,t)}splitTags(t){let e=[...t],i=e.length,n=0,s=!1,l=0;const a=i;let d=!1;const o=[],h=[];for(;e.length>0&&!s&&!d;){if(n===i){if(n=0,e=Object.values(e),i=e.length,i===0){s=!0;continue}l++,d=l>a+1}const u=e[n];if(e.length===1&&u.name==="Eof"){s=!0;continue}if(this.isClosedTag(u)&&u.name!=="Eof"){h[n]=e[n],delete e[n],n++;continue}if(n+1<i){const x=e[n+1];if(!this.isCloserTag(u)&&this.isCloserTag(x)){if(u.name!==x.name){o.push(u),delete e[n],n++;continue}h[n]=e[n],h[n+1]=e[n+1],delete e[n],delete e[n+1],n+=2;continue}}n++}return{regularTags:h,singleTags:o}}replaceTags(t,e){let i=t,n=e;const s=[];e.forEach(l=>{s[l.id]=l}),s.sort(),n=Object.values(s);for(let l=n.length-1;l>-1;l--){const a=n[l];a.text=a.text.substring(0,a.text.length-4)+lt+W;const d=i.substring(0,a.startsAt),o=i.substring(a.endsAt+1);i=d+a.text+o}return i}doComponents(t="[\\w]+"){let e=g(this,$);const i=this.collectTags(e,t),n=[];let s=[],l=0;const a=[];let d=i.length,o=0,h=!1,u=0;const x=d;let y=!1;a[l]=-1;const{singleTags:I}=this.splitTags(i);let w=i;for(I.length&&(I.forEach(E=>n.push(E.id)),e=this.replaceTags(e,I),w=this.collectTags(e,t));w.length>0&&!h&&!y;){if(o===d){if(o=0,w=Object.values(w),d=w.length,d===0){h=!0;continue}u++,y=u>x+1}const E=w[o];if(w.length===1&&E.name==="Eof"){h=!0;continue}if(this.isClosedTag(E)&&E.name!=="Eof"){const j=this.makeTag(E,a,l,!1);j.isSingle=n.includes(E.id),s[j.id]=j,delete w[o],o++;continue}if(this.isCloserTag(E)&&l--,o+1<d){const j=w[o+1];if(!this.isCloserTag(E)&&this.isCloserTag(j)){const q=this.makeTag(E,a,l,!0),S=this.makeTag(j,a,l,!1,!0);S.contents={},S.parentId=q.id,S.contents.startsAt=q.endsAt+1,S.contents.endsAt=S.startsAt;const rt=e.substring(S.contents.startsAt,S.contents.endsAt);S.contents.text=rt,q.closer=S,s[q.id]=q,delete w[o],delete w[o+1],o+=2;continue}!this.isCloserTag(E)&&!this.isCloserTag(j)&&(l++,a[l]=E.id)}o++}s=Object.values(s),L(this,$,e),L(this,K,s)}}K=new WeakMap,G=new WeakMap,$=new WeakMap,R=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,Q=new WeakMap,tt=new WeakMap,nt=new WeakSet,bt=function(){return Date.now()*Math.random()};const O="&lt;",v="&gt;",B="<",H=">",F="/",N=`
`;class dt{constructor(t,e,i,n,s){_(this,et,"");_(this,U,60);_(this,st,!1);_(this,J,()=>{});_(this,z,()=>{});L(this,J,t),L(this,et,e),L(this,U,i),L(this,z,s),L(this,st,n)}async writeLikeAHuman(t,e){const i=e!==void 0,n=g(this,J).querySelector(`pre#${e} code`),s=g(this,J).querySelector(i?`pre#${t} code`:`div#${t}`);let l=g(this,U),a=[],d="",o="",h="",u=null,x=[];const y=[];let I="",w="",E=-1;const j=[],q=[];let S=0,rt=this;function gt(r){return new Promise(c=>{setTimeout(c,r)})}function $t(r){return Math.floor(r*.75+Math.random()*r)}async function A(r,c=!1){let T=a.join("");c&&(T=T.trim()),l=$t(g(rt,U)),d+=r,s.innerHTML=d+T,i&&window.hljs!==void 0&&window.hljs.highlightElement(s),await gt(l)}async function St(){const r=a.join("");d=d.substring(0,d.length-1),s.innerHTML=d+r,await gt(l)}function V(r){a.unshift(r)}function it(){delete a[0],a=Object.values(a)}function Lt(r){const c=[],T=/^([^\S][ \s]+)*/gm;let D;for(;(D=T.exec(r))!==null;)D.index===T.lastIndex&&T.lastIndex++,c.push(D[0]??"");return c}function Ot(r){const c=/^([^\S][ \s]+)*/gm;return r.replace(c,"")}function Mt(r){const c=r.split(`
`);return`<br />
`.repeat(c.length)}async function It(r){let c="";return await fetch(r).then(T=>T.text()).then(T=>{c=T}),c}function vt(r){return r.replaceAll(O,B).replaceAll(v,H)}function jt(){let r=null;return x.length&&(r=x.shift(),r.hasCloser&&y.push(r)),r}function Dt(){return y.length?y[y.length-1]:null}function Bt(){if(!j.length)return null;const r=j.pop(),c=q.pop();V(c?N+o+r:r)}function pt(r){let c=null;if(!y.length||(c=Dt(),r===c.depth))return c;let T=!1;for(let D=y.length-1;D>-1;D--)if(c=y[D],r===c.depth){T=!0;break}return T?c:null}const Nt=g(this,et);I=await It(Nt);const mt=Lt(I);I=Ot(I);const b=new Tt(I,i);if(b.doComponents(),x=[...b.list],w=b.workingText.replace(`${N+O}Eof ${F}${v}`,""),i){console.log({sourceComponent:n});const r=Mt(I+`
`);console.log({emptyText:r}),n.innerHTML=r,window.hljs!==void 0&&window.hljs.highlightElement(n)}const qt=mt[S]??"";await A(qt),S++;for(let r=0;r<w.length;r++){let c=w[r];if(i&&c===B){c=O,await A(c);continue}if(g(this,st)&&b.mistakes.length&&b.phraseStarts.length&&b.phraseStarts[0]===r){const k=b.phraseLengths[0];for(let p=0;p<k;p++){const P=r+p,at=b.mistakeCursors[0];if(c=w[P],at===P?await A(b.mistakes[0]):await A(c),b.wordEnds.includes(P)&&b.mistakeCursors.length){const ot=b.mistakeCursors[0];if(ot<=P){const ct=P-ot+1;for(let xt=0;xt<ct;xt++)await St(),p--;b.mistakes.shift(),b.mistakeCursors.shift()}}}b.phraseStarts.shift(),b.phraseLengths.shift(),r+=k-1;continue}const T=w.substring(r,r+4),D=w.substring(r,r+5);if(c==="&"&&D==="&oq;/"){const k=w.substring(r+5,r+6),{word:p}=b.translateBracket(c,k);it(),await A(p),r+=9;continue}if(c==="&"&&T==="&oq;"){const k=w.substring(r+4,r+5),{word:p}=b.translateBracket(c,k);V(p),await A(p),r+=8;continue}if(c==="&"&&T==="&pp;"){r+=3,await A(O);continue}if(c==="&"&&T==="&pg;"){r+=3,await A(v);continue}if(i){if(c==="/"&&D===F+v&&u!==null&&!u.hasCloser&&u.endsAt===r+4){c=F+v,it(),await A(c),r+=4;continue}if(c==="&"&&T===v&&u!==null&&u.endsAt===r+3){it(),await A(v),u.hasCloser&&Bt(),r+=3;continue}}if(c==="&"&&D===O+F){u=pt(E),u===null&&E-1>-1&&(u=pt(E-1)),c=u.closer.text,i||(c=B+F+u.closer.name+H);const{word:k}=b.translateBracket(c,u.name,!0);if(c=k,c!==""){it(),r=u.closer.endsAt,await A(c),E--,u=null;continue}}if(c==="&"&&T!==O){const k=w.substring(r).indexOf(";");if(k>8){await A(c);continue}const p=w.substring(r,r+k+1);await A(p),r+=p.length-1;continue}if(c==="&"&&T===O){if((u===null||u!==null&&u.dirty)&&(u=jt()),u.startsAt!==r){i?(c=O,r+=3):(c=u.text.replace(O,B),c=c.replace(v,H)),await A(c),u.dirty=!1;continue}u.dirty=!0;let k=!1,p="";c=u.text,i||(c=u.text.replace(O,B),c=c.replace(v,H));const{word:P,translated:at}=b.translateBracket(c,u.name);if(c=P,u.hasCloser){E++,p=u.closer.text,i||(p=B+F+u.closer.name+H);const{word:ot,translated:ct}=b.translateBracket(p,u.name,!0);p=ot,k=u.closer.contents.text.indexOf(N)>-1,ct?(r=u.endsAt,V(k?N+o+p:p)):(j.push(p),q.push(k))}at||(k=u.text.indexOf(N)>-1,i?(c=O,r+=3,p=v):(c=u.text.replace(O,B),c=c.replace(v,H),r+=u.text.length-1,p=B+F+u.closer.name+H),V(k?N+o+p:p)),await A(c);continue}if(c===N){o=mt[S]??"",h=N+o;const k=a.length?a[0].trim():"",p=w.substring(r+1,r+k.length+1);S++,await A(h,k===p);continue}await A(c)}d=vt(d),this.finishedEvent(d)}finishedEvent(t){typeof g(this,z)=="function"&&g(this,z).call(this,t)}}et=new WeakMap,U=new WeakMap,st=new WeakMap,J=new WeakMap,z=new WeakMap;const Wt="",kt=[f.createElementVNode("div",{class:"to-be-copied"},[f.createElementVNode("pre",{id:"to-copy"},[f.createElementVNode("code")])],-1),f.createElementVNode("div",{class:"to-be-written"},[f.createElementVNode("pre",{id:"to-write"},[f.createElementVNode("code")])],-1)],yt=f.defineComponent({name:"CodeWriter"}),ht=Object.assign(yt,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1},useHighlightJs:{default:!1},theme:{default:"base16/monokai"},language:{default:"html"}},setup(M){const t=M,e=f.ref(null);f.onMounted(async()=>{const s=e.value.ownerDocument;if(t.useHighlightJs){const l=t.theme??"base16/monokai",a=t.language??"html",d=s.createElement("script");d.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",s.head.appendChild(d);const o=[];o.push("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"),o.push(`https://highlightjs.org/static/demo/styles/${l}.css`),o.forEach(u=>{const x=s.createElement("style");x.innerHTML=`@import "${u}"`,s.head.appendChild(x)});const h=s.querySelectorAll("code");for(const u of h)u.setAttribute("class",`language-${a}`)}if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(d=>{const o=s.createElement("style");o.innerHTML=`@import "${d}"`,s.head.appendChild(o)}),s.getElementById("to-write").setAttribute("class",t.classes)),t.dependsOnSelector!==""){const l=s.querySelector(t.dependsOnSelector);if(l!==null){const a={attributes:!0};new MutationObserver(async(o,h)=>{for(const u of o)u.type==="attributes"&&u.attributeName==="finished"&&l.getAttribute("finished")==="true"&&(h.disconnect(),await n())}).observe(l,a)}}else await n()});const i=function(s){const l=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:s}});e.value.dispatchEvent(l),e.value.setAttribute("finished","true")},n=async()=>{const s=e.value.ownerDocument;await new dt(s,t.source,t.speed,t.makeTypos,i).writeLikeAHuman("to-write","to-copy")};return(s,l)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:e,class:"code-snippet"},kt,512))}}),Et=[f.createElementVNode("div",{class:"to-be-written"},[f.createElementVNode("div",{id:"to-write"})],-1)],At=f.defineComponent({name:"TextWriter"}),ft=Object.assign(At,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1}},setup(M){const t=M,e=f.ref(null);f.onMounted(async()=>{const s=e.value.ownerDocument;if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(d=>{const o=s.createElement("style");o.innerHTML=`@import "${d}"`,s.head.appendChild(o)}),s.getElementById("to-write").setAttribute("class",t.classes)),t.dependsOnSelector!==""){const l=s.querySelector(t.dependsOnSelector);if(l!==null){const a={attributes:!0};new MutationObserver(async(o,h)=>{for(const u of o)u.type==="attributes"&&u.attributeName==="finished"&&l.getAttribute("finished")==="true"&&(h.disconnect(),await n())}).observe(l,a)}}else await n()});const i=function(s){const l=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:s}});e.value.dispatchEvent(l),e.value.setAttribute("finished","true")},n=async()=>{const s=e.value.ownerDocument;await new dt(s,t.source,t.speed,t.makeTypos,i).writeLikeAHuman("to-write")};return(s,l)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:e,class:"text-snippet"},Et,512))}}),Ct=M=>({textSpeed:M.speed,textTypos:M.makeTypos}),_t={install(M,t){M.config.globalProperties.$writerOptions=Ct(t),M.component("TextWriter",ft),M.component("CodeWriter",ht)}};m.CodeWriter=ht,m.TextWriter=ft,m.VueWriterPlugin=_t,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
