(function(b,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],f):(b=typeof globalThis<"u"?globalThis:b||self,f(b.VuePlugin={},b.Vue))})(this,function(b,f){var K,P,$,R,X,Y,Z,Q,tt,nt,bt,et,U,st,z,J;"use strict";var ut=(b,f,_)=>{if(!f.has(b))throw TypeError("Cannot "+_)};var m=(b,f,_)=>(ut(b,f,"read from private field"),_?_.call(b):f.get(b)),S=(b,f,_)=>{if(f.has(b))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(b):f.set(b,_)},I=(b,f,_,H)=>(ut(b,f,"write to private field"),H?H.call(b,_):f.set(b,_),_);var wt=(b,f,_)=>(ut(b,f,"access private method"),_);const _="&lt;",H="&gt;",ot="/";class Tt{constructor(t,s=!1){S(this,nt);S(this,K,[]);S(this,P,"");S(this,$,"");S(this,R,[]);S(this,X,[]);S(this,Y,[]);S(this,Z,[]);S(this,Q,[]);S(this,tt,[]);I(this,P,t.trim()),I(this,$,`${m(this,P)}
<Eof />`),this.protect(),s&&this.markupQuotes(),this.collectWords(m(this,$)),this.makeMistakes()}get list(){return m(this,K)}get text(){return m(this,P)}get workingText(){return m(this,$)}get words(){return m(this,R)}get mistakes(){return m(this,Q)}get mistakeCursors(){return m(this,tt)}get phraseStarts(){return m(this,X)}get phraseLengths(){return m(this,Y)}get wordEnds(){return m(this,Z)}translateBracket(t,s,i=!1){let n=t,o=!1;return"CDETQRG".includes(s)&&(s==="C"&&(n=i?")":"(",o=!0),s==="D"&&(n=i?"}}":"{{",o=!0),s==="E"&&(n=i?"}":"{",o=!0),s==="T"&&(n=i?"]":"[",o=!0),s==="Q"&&(n="'",o=!0),s==="R"&&(n='"',o=!0),s==="G"&&(n="`",o=!0)),{word:n,translated:o}}markupQuotes(){let t=m(this,$);const s=/(["'`])((\s|((\\)*)\\.|.)*?)\1/gm;let i;const n=[];for(;(i=s.exec(t))!==null;)i.index===s.lastIndex&&s.lastIndex++,n.push(i);for(let o=n.length-1;o>-1;o--){const d=n[o],a=d[1],u=d[0];let e=d[2];const h=d.index+1,c=h+u.length-1;let p="";a==='"'?p="R":a==="'"?p="Q":a==="`"&&(p="G"),e=e.replace(/&lt;/g,"&pp;"),e=e.replace(/&gt;/g,"&pg;");const x=`&oq;${p}&cq;${e}&oq;/${p}&cq;`,C=t.substring(0,h-1),g=t.substring(c);t=C+x+g}I(this,$,t)}doAttributes(t){const s={},i=/([\w]*)(\[\])?=("([\S ][^"]*)"|'([\S]*)'|\{\{ ([\w]*) \}\}|\{([\S ]*)\})/gm;let n;const o=[];for(;(n=i.exec(t))!==null;)n.index===i.lastIndex&&i.lastIndex++,o.push(n);for(let d=0;d<o.length;d++){const a=o[d],u=a[1],e=a[2],h=a[3].substring(0,1),c=a[4];e==="[]"?(s[u]===void 0&&(s[u]=[]),s[u].push(h+c)):s[u]=`${h}${c}`}return s}isClosedTag(t){let s=!1;const{text:i}=t;return i===""||(s=i.substring(i.length-5,i.length)===ot+H),s}isCloserTag(t){let s=!1;const{text:i}=t;return i===""||(s=i.substring(0,5)===_+ot),s}makeTag(t,s,i,n,o=!1){const{text:d}=t,{name:a}=t,u=this.list.length,e={};return e.id=t.id,e.name=a===""?"Fragment":a,e.text=d,e.startsAt=t.startsAt,e.endsAt=t.endsAt,o||(e.uid=wt(this,nt,bt),e.method="echo",e.props=e.name==="Fragment"?[]:[],e.depth=i,e.hasCloser=n,e.node=!1,e.isSingle=!1),(s[i]===void 0||s[i]===null)&&(s[i]=u-1),e.parentId=s[i],e}protect(){let t=m(this,$);t=t.trim(),t=t.replace(/\{\{/g,"<D>"),t=t.replace(/\}\}/g,"</D>"),t=t.replace(/\(/g,"<C>"),t=t.replace(/\)/g,"</C>"),t=t.replace(/\{/g,"<E>"),t=t.replace(/\}/g,"</E>"),t=t.replace(/\[/g,"<T>"),t=t.replace(/\]/g,"</T>"),t=t.replace(/<([/\w])/g,`${_}$1`),t=t.replace(/>/g,H),I(this,$,t)}collectTags(t,s="[\\w]+"){const i=[],n=[],o=`${_}\\/?(${s})((\\s|.*?)*?)\\/?${H}`,d=new RegExp(o,"gm");let a;for(;(a=d.exec(t))!==null;)a.index===d.lastIndex&&d.lastIndex++,n.push(a);let u=0;return n.forEach(e=>{const h=e;h.id=u,h.text=e[0],h.name=e[1]===null?"Fragment":e[1],h.startsAt=e.index,h.endsAt=e.index+h.text.length-1,delete h[0],delete h[1],delete h[2],delete h[3],i.push(h),u++}),i}collectWords(t){const s=[],i=[];let n=/([&oqpg;]{4})[\w /]+([&cqpp;]{4})/gm,o;for(;(o=n.exec(t))!==null;)o.index===n.lastIndex&&n.lastIndex++,i.push(o);let d=t;for(let a=i.length-1;a>-1;a--){const u=i[a][0],e=i[a].index+1,h=e+u.length-1,c="•".repeat(u.length),p=d.substring(0,e-1),x=d.substring(h);d=p+c+x}for(n=/([&lt;]{4})[\w /]+([&gt;]{4})/gm;(o=n.exec(d))!==null;)o.index===n.lastIndex&&n.lastIndex++,i.push(o);for(let a=i.length-1;a>-1;a--){const u=i[a][0],e=i[a].index+1,h=e+u.length-1,c="•".repeat(u.length),p=d.substring(0,e-1),x=d.substring(h);d=p+c+x}for(n=/([&ltgt;]{4})/gm;(o=n.exec(d))!==null;)o.index===n.lastIndex&&n.lastIndex++,i.push(o);for(let a=i.length-1;a>-1;a--){const u=i[a][0],e=i[a].index+1,h=e+u.length-1,c="•".repeat(u.length),p=d.substring(0,e-1),x=d.substring(h);d=p+c+x}for(n=/((?!•)\S[^•\n]*)/g;(o=n.exec(d))!==null;)o.index===n.lastIndex&&n.lastIndex++,m(this,X).push(o.index),m(this,Y).push(o[0].length);for(n=/((?!•)\S[^•\n ]*)/g;(o=n.exec(d))!==null;){o.index===n.lastIndex&&n.lastIndex++;const a={};a.text=o[0],a.startsAt=o.index,a.endsAt=a.startsAt+o[0].length-1,s.push(a),m(this,Z).push(a.endsAt)}I(this,R,s)}makeMistakes(){let t=Math.ceil(Math.random()*2)-2;const s=Math.ceil(Math.random()*3)+2;m(this,R).forEach(i=>{if(t++,t%s!==0||i.text.length<4)return;const n=Math.ceil(Math.random()*i.text.length)-1,o=String.fromCharCode(Math.ceil(Math.random()*26)+96);m(this,tt).push(i.startsAt+n),m(this,Q).push(o)})}makeFaultyText(){let t=m(this,$);m(this,Q).forEach(s=>{const i=t.substring(0,s.startsAt),n=t.substring(s.endsAt+1);t=i+s.text+n}),I(this,$,t)}splitTags(t){let s=[...t],i=s.length,n=0,o=!1,d=0;const a=i;let u=!1;const e=[],h=[];for(;s.length>0&&!o&&!u;){if(n===i){if(n=0,s=Object.values(s),i=s.length,i===0){o=!0;continue}d++,u=d>a+1}const c=s[n];if(s.length===1&&c.name==="Eof"){o=!0;continue}if(this.isClosedTag(c)&&c.name!=="Eof"){h[n]=s[n],delete s[n],n++;continue}if(n+1<i){const p=s[n+1];if(!this.isCloserTag(c)&&this.isCloserTag(p)){if(c.name!==p.name){e.push(c),delete s[n],n++;continue}h[n]=s[n],h[n+1]=s[n+1],delete s[n],delete s[n+1],n+=2;continue}}n++}return{regularTags:h,singleTags:e}}replaceTags(t,s){let i=t,n=s;const o=[];s.forEach(d=>{o[d.id]=d}),o.sort(),n=Object.values(o);for(let d=n.length-1;d>-1;d--){const a=n[d];a.text=a.text.substring(0,a.text.length-4)+ot+H;const u=i.substring(0,a.startsAt),e=i.substring(a.endsAt+1);i=u+a.text+e}return i}doComponents(t="[\\w]+"){let s=m(this,$);const i=this.collectTags(s,t),n=[];let o=[],d=0;const a=[];let u=i.length,e=0,h=!1,c=0;const p=u;let x=!1;a[d]=-1;const{singleTags:C}=this.splitTags(i);let g=i;for(C.length&&(C.forEach(T=>n.push(T.id)),s=this.replaceTags(s,C),g=this.collectTags(s,t));g.length>0&&!h&&!x;){if(e===u){if(e=0,g=Object.values(g),u=g.length,u===0){h=!0;continue}c++,x=c>p+1}const T=g[e];if(g.length===1&&T.name==="Eof"){h=!0;continue}if(this.isClosedTag(T)&&T.name!=="Eof"){const j=this.makeTag(T,a,d,!1);j.isSingle=n.includes(T.id),o[j.id]=j,delete g[e],e++;continue}if(this.isCloserTag(T)&&d--,e+1<u){const j=g[e+1];if(!this.isCloserTag(T)&&this.isCloserTag(j)){const q=this.makeTag(T,a,d,!0),v=this.makeTag(j,a,d,!1,!0);v.contents={},v.parentId=q.id,v.contents.startsAt=q.endsAt+1,v.contents.endsAt=v.startsAt;const rt=s.substring(v.contents.startsAt,v.contents.endsAt);v.contents.text=rt,q.closer=v,o[q.id]=q,delete g[e],delete g[e+1],e+=2;continue}!this.isCloserTag(T)&&!this.isCloserTag(j)&&(d++,a[d]=T.id)}e++}o=Object.values(o),I(this,$,s),I(this,K,o)}}K=new WeakMap,P=new WeakMap,$=new WeakMap,R=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,Q=new WeakMap,tt=new WeakMap,nt=new WeakSet,bt=function(){return Date.now()*Math.random()};const L="&lt;",M="&gt;",N="<",F=">",V="/",B=`
`;class dt{constructor(t,s,i,n,o){S(this,et,"");S(this,U,60);S(this,st,!1);S(this,z,()=>{});S(this,J,()=>{});I(this,z,t),I(this,et,s),I(this,U,i),I(this,J,o),I(this,st,n)}async writeLikeAHuman(t,s){const i=s!==void 0,n=m(this,z).querySelector(`pre.to-place.${s} code`),o=m(this,z).querySelector(i?`pre.to-place.${t} code`:`div.to-write.${t}`);let d=m(this,U),a=[],u="",e="",h="",c=null,p=[];const x=[];let C="",g="",T=-1;const j=[],q=[];let v=0,rt=this;function gt(l){return new Promise(r=>{setTimeout(r,l)})}function It(l){return Math.floor(l*.75+Math.random()*l)}async function A(l,r=!1){let y=a.join("");r&&(y=y.trim()),d=It(m(rt,U)),u+=l,o.innerHTML=u+y,i&&window.hljs!==void 0&&window.hljs.highlightElement(o),await gt(d)}async function Lt(){const l=a.join("");u=u.substring(0,u.length-1),o.innerHTML=u+l,await gt(d)}function W(l){a.unshift(l)}function it(){delete a[0],a=Object.values(a)}function Ot(l){const r=[],y=/^([^\S][ \s]+)*/gm;let D;for(;(D=y.exec(l))!==null;)D.index===y.lastIndex&&y.lastIndex++,r.push(D[0]??"");return r}function Mt(l){const r=/^([^\S][ \s]+)*/gm;return l.replace(r,"")}function jt(l){const r=l.split(`
`);return`<br />
`.repeat(r.length)}async function Dt(l){let r="";return await fetch(l).then(y=>y.text()).then(y=>{r=y}),r}function Nt(l){return l.replaceAll(L,N).replaceAll(M,F)}function Bt(){let l=null;return p.length&&(l=p.shift(),l.hasCloser&&x.push(l)),l}function qt(){return x.length?x[x.length-1]:null}function Ht(){if(!j.length)return null;const l=j.pop(),r=q.pop();W(r?B+e+l:l)}function pt(l){let r=null;if(!x.length||(r=qt(),l===r.depth))return r;let y=!1;for(let D=x.length-1;D>-1;D--)if(r=x[D],l===r.depth){y=!0;break}return y?r:null}const Ft=m(this,et);C=await Dt(Ft);const mt=Ot(C);C=Mt(C);const k=new Tt(C,i);if(k.doComponents(),p=[...k.list],g=k.workingText.replace(`${B+L}Eof ${V}${M}`,""),i){console.log({sourceComponent:n});const l=jt(C+`
`);console.log({emptyText:l}),n.innerHTML=l,window.hljs!==void 0&&window.hljs.highlightElement(n)}const Vt=mt[v]??"";await A(Vt),v++;for(let l=0;l<g.length;l++){let r=g[l];if(i&&r===N){r=L,await A(r);continue}if(m(this,st)&&k.mistakes.length&&k.phraseStarts.length&&k.phraseStarts[0]===l){const E=k.phraseLengths[0];for(let w=0;w<E;w++){const G=l+w,at=k.mistakeCursors[0];if(r=g[G],at===G?await A(k.mistakes[0]):await A(r),k.wordEnds.includes(G)&&k.mistakeCursors.length){const lt=k.mistakeCursors[0];if(lt<=G){const ct=G-lt+1;for(let xt=0;xt<ct;xt++)await Lt(),w--;k.mistakes.shift(),k.mistakeCursors.shift()}}}k.phraseStarts.shift(),k.phraseLengths.shift(),l+=E-1;continue}const y=g.substring(l,l+4),D=g.substring(l,l+5);if(r==="&"&&D==="&oq;/"){const E=g.substring(l+5,l+6),{word:w}=k.translateBracket(r,E);it(),await A(w),l+=9;continue}if(r==="&"&&y==="&oq;"){const E=g.substring(l+4,l+5),{word:w}=k.translateBracket(r,E);W(w),await A(w),l+=8;continue}if(r==="&"&&y==="&pp;"){l+=3,await A(L);continue}if(r==="&"&&y==="&pg;"){l+=3,await A(M);continue}if(i){if(r==="/"&&D===V+M&&c!==null&&!c.hasCloser&&c.endsAt===l+4){r=V+M,it(),await A(r),l+=4;continue}if(r==="&"&&y===M&&c!==null&&c.endsAt===l+3){it(),await A(M),c.hasCloser&&Ht(),l+=3;continue}}if(r==="&"&&D===L+V){c=pt(T),c===null&&T-1>-1&&(c=pt(T-1)),r=c.closer.text,i||(r=N+V+c.closer.name+F);const{word:E}=k.translateBracket(r,c.name,!0);if(r=E,r!==""){it(),l=c.closer.endsAt,await A(r),T--,c=null;continue}}if(r==="&"&&y!==L){const E=g.substring(l).indexOf(";");if(E>8){await A(r);continue}const w=g.substring(l,l+E+1);await A(w),l+=w.length-1;continue}if(r==="&"&&y===L){if((c===null||c!==null&&c.dirty)&&(c=Bt()),c.startsAt!==l){i?(r=L,l+=3):(r=c.text.replace(L,N),r=r.replace(M,F)),await A(r),c.dirty=!1;continue}c.dirty=!0;let E=!1,w="";r=c.text,i||(r=c.text.replace(L,N),r=r.replace(M,F));const{word:G,translated:at}=k.translateBracket(r,c.name);if(r=G,c.hasCloser){T++,w=c.closer.text,i||(w=N+V+c.closer.name+F);const{word:lt,translated:ct}=k.translateBracket(w,c.name,!0);w=lt,E=c.closer.contents.text.indexOf(B)>-1,ct?(l=c.endsAt,W(E?B+e+w:w)):(j.push(w),q.push(E))}at||(E=c.text.indexOf(B)>-1,i?(r=L,l+=3,w=M):(r=c.text.replace(L,N),r=r.replace(M,F),l+=c.text.length-1,w=N+V+c.closer.name+F),W(E?B+e+w:w)),await A(r);continue}if(r===B){e=mt[v]??"",h=B+e;const E=a.length?a[0].trim():"",w=g.substring(l+1,l+E.length+1);v++,await A(h,E===w);continue}await A(r)}u=Nt(u),this.finishedEvent(u)}finishedEvent(t){typeof m(this,J)=="function"&&m(this,J).call(this,t)}}et=new WeakMap,U=new WeakMap,st=new WeakMap,z=new WeakMap,J=new WeakMap;const Wt="",kt={class:"to-be-placed"},yt=[f.createElementVNode("code",null,null,-1)],Et={class:"to-be-written"},Ct=[f.createElementVNode("code",null,null,-1)],At=f.defineComponent({name:"CodeWriter"}),ht=Object.assign(At,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1},useHighlightJs:{default:!1},theme:{default:"base16/monokai"},language:{default:"html"}},setup(O){const t=O,s=f.ref(null),i=f.ref(""),n=f.ref(""),o=f.ref(""),d=()=>{let e=Date.now().toString();return e=e.substring(e.length-4),e=btoa(e),e=e.replace(/=/g,""),e};i.value=d(),n.value="to-place-"+i.value,o.value="to-write-"+i.value,f.onMounted(async()=>{const e=s.value.ownerDocument;if(t.useHighlightJs){const h=t.theme??"base16/monokai",c=t.language??"html",p=e.createElement("script");p.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",e.head.appendChild(p);const x=[];x.push("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"),x.push(`https://highlightjs.org/static/demo/styles/${h}.css`),x.forEach(g=>{const T=e.createElement("style");T.innerHTML=`@import "${g}"`,e.head.appendChild(T)});const C=e.querySelectorAll("code");for(const g of C)g.setAttribute("class",`language-${c}`)}if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(p=>{const x=e.createElement("style");x.innerHTML=`@import "${p}"`,e.head.appendChild(x)}),e.getElementById(o.value).setAttribute("class",t.classes)),t.dependsOnSelector!==""){const h=e.querySelector(t.dependsOnSelector);if(h!==null){const c={attributes:!0};new MutationObserver(async(x,C)=>{for(const g of x)g.type==="attributes"&&g.attributeName==="finished"&&h.getAttribute("finished")==="true"&&(C.disconnect(),await u())}).observe(h,c)}}else await u()});const a=function(e){const h=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:e}});s.value.dispatchEvent(h),s.value.setAttribute("finished","true")},u=async()=>{const e=s.value.ownerDocument;await new dt(e,t.source,t.speed,t.makeTypos,a).writeLikeAHuman(o.value,n.value)};return(e,h)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:s,class:"code-snippet"},[f.createElementVNode("div",kt,[f.createElementVNode("pre",{class:f.normalizeClass(["to-place",n.value])},yt,2)]),f.createElementVNode("div",Et,[f.createElementVNode("pre",{class:f.normalizeClass(["to-write",o.value])},Ct,2)])],512))}}),_t={class:"to-be-written"},St=f.defineComponent({name:"TextWriter"}),ft=Object.assign(St,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1}},setup(O){const t=O,s=f.ref(null),i=f.ref(""),n=f.ref(""),o=()=>{let u=Date.now().toString();return u=u.substring(u.length-4),u=btoa(u),u=u.replace(/=/g,""),u};i.value=o(),n.value="paper-"+i.value,f.onMounted(async()=>{const u=s.value.ownerDocument;if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(c=>{const p=u.createElement("style");p.innerHTML=`@import "${c}"`,u.head.appendChild(p)}),u.querySelector("."+n.value).setAttribute("class",t.classes)),t.dependsOnSelector!==""){const e=u.querySelector(t.dependsOnSelector);if(e!==null){const h={attributes:!0};new MutationObserver(async(p,x)=>{for(const C of p)C.type==="attributes"&&C.attributeName==="finished"&&e.getAttribute("finished")==="true"&&(x.disconnect(),await a())}).observe(e,h)}}else await a()});const d=function(u){const e=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:u}});s.value.dispatchEvent(e),s.value.setAttribute("finished","true")},a=async()=>{const u=s.value.ownerDocument;await new dt(u,t.source,t.speed,t.makeTypos,d).writeLikeAHuman(n.value)};return(u,e)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:s,class:"text-snippet"},[f.createElementVNode("div",_t,[f.createElementVNode("div",{class:f.normalizeClass(["to-write",n.value])},null,2)])],512))}}),$t=O=>({textSpeed:O.speed,textTypos:O.makeTypos}),vt={install(O,t){O.config.globalProperties.$writerOptions=$t(t),O.component("text-writer",ft),O.component("code-writer",ht)}};b.CodeWriter=ht,b.TextWriter=ft,b.VueWriterPlugin=vt,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
