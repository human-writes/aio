(function(b,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],f):(b=typeof globalThis<"u"?globalThis:b||self,f(b.VuePlugin={},b.Vue))})(this,function(b,f){var K,P,I,R,X,Y,Z,Q,tt,nt,bt,et,z,st,U,J;"use strict";var ut=(b,f,S)=>{if(!f.has(b))throw TypeError("Cannot "+S)};var g=(b,f,S)=>(ut(b,f,"read from private field"),S?S.call(b):f.get(b)),v=(b,f,S)=>{if(f.has(b))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(b):f.set(b,S)},_=(b,f,S,H)=>(ut(b,f,"write to private field"),H?H.call(b,S):f.set(b,S),S);var wt=(b,f,S)=>(ut(b,f,"access private method"),S);const S="&lt;",H="&gt;",ot="/";class Tt{constructor(t,e=!1){v(this,nt);v(this,K,[]);v(this,P,"");v(this,I,"");v(this,R,[]);v(this,X,[]);v(this,Y,[]);v(this,Z,[]);v(this,Q,[]);v(this,tt,[]);_(this,P,t.trim()),_(this,I,`${g(this,P)}
<Eof />`),this.protect(),e&&this.markupQuotes(),this.collectWords(g(this,I)),this.makeMistakes()}get list(){return g(this,K)}get text(){return g(this,P)}get workingText(){return g(this,I)}get words(){return g(this,R)}get mistakes(){return g(this,Q)}get mistakeCursors(){return g(this,tt)}get phraseStarts(){return g(this,X)}get phraseLengths(){return g(this,Y)}get wordEnds(){return g(this,Z)}translateBracket(t,e,n=!1){let s=t,r=!1;return"CDETQRG".includes(e)&&(e==="C"&&(s=n?")":"(",r=!0),e==="D"&&(s=n?"}}":"{{",r=!0),e==="E"&&(s=n?"}":"{",r=!0),e==="T"&&(s=n?"]":"[",r=!0),e==="Q"&&(s="'",r=!0),e==="R"&&(s='"',r=!0),e==="G"&&(s="`",r=!0)),{word:s,translated:r}}markupQuotes(){let t=g(this,I);const e=/(["'`])((\s|((\\)*)\\.|.)*?)\1/gm;let n;const s=[];for(;(n=e.exec(t))!==null;)n.index===e.lastIndex&&e.lastIndex++,s.push(n);for(let r=s.length-1;r>-1;r--){const h=s[r],c=h[1],u=h[0];let i=h[2];const d=h.index+1,l=d+u.length-1;let p="";c==='"'?p="R":c==="'"?p="Q":c==="`"&&(p="G"),i=i.replace(/&lt;/g,"&pp;"),i=i.replace(/&gt;/g,"&pg;");const x=`&oq;${p}&cq;${i}&oq;/${p}&cq;`,k=t.substring(0,d-1),m=t.substring(l);t=k+x+m}_(this,I,t)}doAttributes(t){const e={},n=/([\w]*)(\[\])?=("([\S ][^"]*)"|'([\S]*)'|\{\{ ([\w]*) \}\}|\{([\S ]*)\})/gm;let s;const r=[];for(;(s=n.exec(t))!==null;)s.index===n.lastIndex&&n.lastIndex++,r.push(s);for(let h=0;h<r.length;h++){const c=r[h],u=c[1],i=c[2],d=c[3].substring(0,1),l=c[4];i==="[]"?(e[u]===void 0&&(e[u]=[]),e[u].push(d+l)):e[u]=`${d}${l}`}return e}isClosedTag(t){let e=!1;const{text:n}=t;return n===""||(e=n.substring(n.length-5,n.length)===ot+H),e}isCloserTag(t){let e=!1;const{text:n}=t;return n===""||(e=n.substring(0,5)===S+ot),e}makeTag(t,e,n,s,r=!1){const{text:h}=t,{name:c}=t,u=this.list.length,i={};return i.id=t.id,i.name=c===""?"Fragment":c,i.text=h,i.startsAt=t.startsAt,i.endsAt=t.endsAt,r||(i.uid=wt(this,nt,bt),i.method="echo",i.props=i.name==="Fragment"?[]:[],i.depth=n,i.hasCloser=s,i.node=!1,i.isSingle=!1),(e[n]===void 0||e[n]===null)&&(e[n]=u-1),i.parentId=e[n],i}protect(){let t=g(this,I);t=t.trim(),t=t.replace(/\{\{/g,"<D>"),t=t.replace(/\}\}/g,"</D>"),t=t.replace(/\(/g,"<C>"),t=t.replace(/\)/g,"</C>"),t=t.replace(/\{/g,"<E>"),t=t.replace(/\}/g,"</E>"),t=t.replace(/\[/g,"<T>"),t=t.replace(/\]/g,"</T>"),t=t.replace(/<([/\w])/g,`${S}$1`),t=t.replace(/>/g,H),_(this,I,t)}collectTags(t,e="[\\w]+"){const n=[],s=[],r=`${S}\\/?(${e})((\\s|.*?)*?)\\/?${H}`,h=new RegExp(r,"gm");let c;for(;(c=h.exec(t))!==null;)c.index===h.lastIndex&&h.lastIndex++,s.push(c);let u=0;return s.forEach(i=>{const d=i;d.id=u,d.text=i[0],d.name=i[1]===null?"Fragment":i[1],d.startsAt=i.index,d.endsAt=i.index+d.text.length-1,delete d[0],delete d[1],delete d[2],delete d[3],n.push(d),u++}),n}collectWords(t){const e=[],n=[];let s=/([&oqpg;]{4})[\w /]+([&cqpp;]{4})/gm,r;for(;(r=s.exec(t))!==null;)r.index===s.lastIndex&&s.lastIndex++,n.push(r);let h=t;for(let c=n.length-1;c>-1;c--){const u=n[c][0],i=n[c].index+1,d=i+u.length-1,l="•".repeat(u.length),p=h.substring(0,i-1),x=h.substring(d);h=p+l+x}for(s=/([&lt;]{4})[\w /]+([&gt;]{4})/gm;(r=s.exec(h))!==null;)r.index===s.lastIndex&&s.lastIndex++,n.push(r);for(let c=n.length-1;c>-1;c--){const u=n[c][0],i=n[c].index+1,d=i+u.length-1,l="•".repeat(u.length),p=h.substring(0,i-1),x=h.substring(d);h=p+l+x}for(s=/([&ltgt;]{4})/gm;(r=s.exec(h))!==null;)r.index===s.lastIndex&&s.lastIndex++,n.push(r);for(let c=n.length-1;c>-1;c--){const u=n[c][0],i=n[c].index+1,d=i+u.length-1,l="•".repeat(u.length),p=h.substring(0,i-1),x=h.substring(d);h=p+l+x}for(s=/((?!•)\S[^•\n]*)/g;(r=s.exec(h))!==null;)r.index===s.lastIndex&&s.lastIndex++,g(this,X).push(r.index),g(this,Y).push(r[0].length);for(s=/((?!•)\S[^•\n ]*)/g;(r=s.exec(h))!==null;){r.index===s.lastIndex&&s.lastIndex++;const c={};c.text=r[0],c.startsAt=r.index,c.endsAt=c.startsAt+r[0].length-1,e.push(c),g(this,Z).push(c.endsAt)}_(this,R,e)}makeMistakes(){let t=Math.ceil(Math.random()*2)-2;const e=Math.ceil(Math.random()*3)+2;g(this,R).forEach(n=>{if(t++,t%e!==0||n.text.length<4)return;const s=Math.ceil(Math.random()*n.text.length)-1,r=String.fromCharCode(Math.ceil(Math.random()*26)+96);g(this,tt).push(n.startsAt+s),g(this,Q).push(r)})}makeFaultyText(){let t=g(this,I);g(this,Q).forEach(e=>{const n=t.substring(0,e.startsAt),s=t.substring(e.endsAt+1);t=n+e.text+s}),_(this,I,t)}splitTags(t){let e=[...t],n=e.length,s=0,r=!1,h=0;const c=n;let u=!1;const i=[],d=[];for(;e.length>0&&!r&&!u;){if(s===n){if(s=0,e=Object.values(e),n=e.length,n===0){r=!0;continue}h++,u=h>c+1}const l=e[s];if(e.length===1&&l.name==="Eof"){r=!0;continue}if(this.isClosedTag(l)&&l.name!=="Eof"){d[s]=e[s],delete e[s],s++;continue}if(s+1<n){const p=e[s+1];if(!this.isCloserTag(l)&&this.isCloserTag(p)){if(l.name!==p.name){i.push(l),delete e[s],s++;continue}d[s]=e[s],d[s+1]=e[s+1],delete e[s],delete e[s+1],s+=2;continue}}s++}return{regularTags:d,singleTags:i}}replaceTags(t,e){let n=t,s=e;const r=[];e.forEach(h=>{r[h.id]=h}),r.sort(),s=Object.values(r);for(let h=s.length-1;h>-1;h--){const c=s[h];c.text=c.text.substring(0,c.text.length-4)+ot+H;const u=n.substring(0,c.startsAt),i=n.substring(c.endsAt+1);n=u+c.text+i}return n}doComponents(t="[\\w]+"){let e=g(this,I);const n=this.collectTags(e,t),s=[];let r=[],h=0;const c=[];let u=n.length,i=0,d=!1,l=0;const p=u;let x=!1;c[h]=-1;const{singleTags:k}=this.splitTags(n);let m=n;for(k.length&&(k.forEach(T=>s.push(T.id)),e=this.replaceTags(e,k),m=this.collectTags(e,t));m.length>0&&!d&&!x;){if(i===u){if(i=0,m=Object.values(m),u=m.length,u===0){d=!0;continue}l++,x=l>p+1}const T=m[i];if(m.length===1&&T.name==="Eof"){d=!0;continue}if(this.isClosedTag(T)&&T.name!=="Eof"){const $=this.makeTag(T,c,h,!1);$.isSingle=s.includes(T.id),r[$.id]=$,delete m[i],i++;continue}if(this.isCloserTag(T)&&h--,i+1<u){const $=m[i+1];if(!this.isCloserTag(T)&&this.isCloserTag($)){const q=this.makeTag(T,c,h,!0),L=this.makeTag($,c,h,!1,!0);L.contents={},L.parentId=q.id,L.contents.startsAt=q.endsAt+1,L.contents.endsAt=L.startsAt;const rt=e.substring(L.contents.startsAt,L.contents.endsAt);L.contents.text=rt,q.closer=L,r[q.id]=q,delete m[i],delete m[i+1],i+=2;continue}!this.isCloserTag(T)&&!this.isCloserTag($)&&(h++,c[h]=T.id)}i++}r=Object.values(r),_(this,I,e),_(this,K,r)}}K=new WeakMap,P=new WeakMap,I=new WeakMap,R=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,Q=new WeakMap,tt=new WeakMap,nt=new WeakSet,bt=function(){return Date.now()*Math.random()};const O="&lt;",j="&gt;",N="<",F=">",V="/",B=`
`;class dt{constructor(t,e,n,s,r){v(this,et,"");v(this,z,60);v(this,st,!1);v(this,U,()=>{});v(this,J,()=>{});_(this,U,t),_(this,et,e),_(this,z,n),_(this,J,r),_(this,st,s)}async writeLikeAHuman(t,e){const n=e!==void 0,s=g(this,U).querySelector(`pre.to-place.${e} code`),r=g(this,U).querySelector(n?`pre.to-write.${t} code`:`div.to-write.${t}`);let h=g(this,z),c=[],u="",i="",d="",l=null,p=[];const x=[];let k="",m="",T=-1;const $=[],q=[];let L=0,rt=this;function gt(o){return new Promise(a=>{setTimeout(a,o)})}function $t(o){return Math.floor(o*.75+Math.random()*o)}async function A(o,a=!1){let E=c.join("");a&&(E=E.trim()),h=$t(g(rt,z)),u+=o,r.innerHTML=u+E,n&&window.hljs!==void 0&&window.hljs.highlightElement(r),await gt(h)}async function It(){const o=c.join("");u=u.substring(0,u.length-1),r.innerHTML=u+o,await gt(h)}function W(o){c.unshift(o)}function it(){delete c[0],c=Object.values(c)}function Lt(o){const a=[],E=/^([^\S][ \s]+)*/gm;let D;for(;(D=E.exec(o))!==null;)D.index===E.lastIndex&&E.lastIndex++,a.push(D[0]??"");return a}function _t(o){const a=/^([^\S][ \s]+)*/gm;return o.replace(a,"")}function Ot(o){const a=o.split(`
`);return`<br />
`.repeat(a.length)}async function Mt(o){let a="";return await fetch(o).then(E=>E.text()).then(E=>{a=E}),a}function jt(o){return o.replaceAll(O,N).replaceAll(j,F)}function Dt(){let o=null;return p.length&&(o=p.shift(),o.hasCloser&&x.push(o)),o}function Nt(){return x.length?x[x.length-1]:null}function Bt(){if(!$.length)return null;const o=$.pop(),a=q.pop();W(a?B+i+o:o)}function pt(o){let a=null;if(!x.length||(a=Nt(),o===a.depth))return a;let E=!1;for(let D=x.length-1;D>-1;D--)if(a=x[D],o===a.depth){E=!0;break}return E?a:null}const qt=g(this,et);k=await Mt(qt);const mt=Lt(k);k=_t(k);const y=new Tt(k,n);if(y.doComponents(),p=[...y.list],m=y.workingText.replace(`${B+O}Eof ${V}${j}`,""),n){console.log({sourceComponent:s});const o=Ot(k+`
`);console.log({emptyText:o}),s.innerHTML=o,window.hljs!==void 0&&window.hljs.highlightElement(s)}const Ht=mt[L]??"";await A(Ht),L++;for(let o=0;o<m.length;o++){let a=m[o];if(n&&a===N){a=O,await A(a);continue}if(g(this,st)&&y.mistakes.length&&y.phraseStarts.length&&y.phraseStarts[0]===o){const C=y.phraseLengths[0];for(let w=0;w<C;w++){const G=o+w,at=y.mistakeCursors[0];if(a=m[G],at===G?await A(y.mistakes[0]):await A(a),y.wordEnds.includes(G)&&y.mistakeCursors.length){const lt=y.mistakeCursors[0];if(lt<=G){const ct=G-lt+1;for(let xt=0;xt<ct;xt++)await It(),w--;y.mistakes.shift(),y.mistakeCursors.shift()}}}y.phraseStarts.shift(),y.phraseLengths.shift(),o+=C-1;continue}const E=m.substring(o,o+4),D=m.substring(o,o+5);if(a==="&"&&D==="&oq;/"){const C=m.substring(o+5,o+6),{word:w}=y.translateBracket(a,C);it(),await A(w),o+=9;continue}if(a==="&"&&E==="&oq;"){const C=m.substring(o+4,o+5),{word:w}=y.translateBracket(a,C);W(w),await A(w),o+=8;continue}if(a==="&"&&E==="&pp;"){o+=3,await A(O);continue}if(a==="&"&&E==="&pg;"){o+=3,await A(j);continue}if(n){if(a==="/"&&D===V+j&&l!==null&&!l.hasCloser&&l.endsAt===o+4){a=V+j,it(),await A(a),o+=4;continue}if(a==="&"&&E===j&&l!==null&&l.endsAt===o+3){it(),await A(j),l.hasCloser&&Bt(),o+=3;continue}}if(a==="&"&&D===O+V){l=pt(T),l===null&&T-1>-1&&(l=pt(T-1)),a=l.closer.text,n||(a=N+V+l.closer.name+F);const{word:C}=y.translateBracket(a,l.name,!0);if(a=C,a!==""){it(),o=l.closer.endsAt,await A(a),T--,l=null;continue}}if(a==="&"&&E!==O){const C=m.substring(o).indexOf(";");if(C>8){await A(a);continue}const w=m.substring(o,o+C+1);await A(w),o+=w.length-1;continue}if(a==="&"&&E===O){if((l===null||l!==null&&l.dirty)&&(l=Dt()),l.startsAt!==o){n?(a=O,o+=3):(a=l.text.replace(O,N),a=a.replace(j,F)),await A(a),l.dirty=!1;continue}l.dirty=!0;let C=!1,w="";a=l.text,n||(a=l.text.replace(O,N),a=a.replace(j,F));const{word:G,translated:at}=y.translateBracket(a,l.name);if(a=G,l.hasCloser){T++,w=l.closer.text,n||(w=N+V+l.closer.name+F);const{word:lt,translated:ct}=y.translateBracket(w,l.name,!0);w=lt,C=l.closer.contents.text.indexOf(B)>-1,ct?(o=l.endsAt,W(C?B+i+w:w)):($.push(w),q.push(C))}at||(C=l.text.indexOf(B)>-1,n?(a=O,o+=3,w=j):(a=l.text.replace(O,N),a=a.replace(j,F),o+=l.text.length-1,w=N+V+l.closer.name+F),W(C?B+i+w:w)),await A(a);continue}if(a===B){i=mt[L]??"",d=B+i;const C=c.length?c[0].trim():"",w=m.substring(o+1,o+C.length+1);L++,await A(d,C===w);continue}await A(a)}u=jt(u),this.finishedEvent(u)}finishedEvent(t){typeof g(this,J)=="function"&&g(this,J).call(this,t)}}et=new WeakMap,z=new WeakMap,st=new WeakMap,U=new WeakMap,J=new WeakMap;const Ft="",kt={class:"to-be-placed"},yt={class:"to-be-written"},Et=f.defineComponent({name:"CodeWriter"}),ht=Object.assign(Et,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1},useHighlightJs:{default:!1},theme:{default:"base16/monokai"},language:{default:"html"}},setup(M){const t=M,e=f.ref(null),n=f.ref(""),s=f.ref(""),r=f.ref(""),h=f.ref(""),c=()=>{let d=Date.now().toString();return d=d.substring(d.length-4),d=btoa(d),d=d.replace(/=/g,""),d};n.value=c(),s.value="to-place-"+n.value,r.value="to-write-"+n.value,h.value="to-code-"+n.value,f.onMounted(async()=>{const d=e.value.ownerDocument;if(t.useHighlightJs&&window.hljs===void 0){const l=t.theme??"base16/monokai",p=t.language??"html",x=d.createElement("script");x.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",d.head.appendChild(x);const k=[];k.push("https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"),k.push(`https://highlightjs.org/static/demo/styles/${l}.css`),k.forEach(T=>{const $=d.createElement("style");$.innerHTML=`@import "${T}"`,d.head.appendChild($)});const m=d.querySelectorAll(h.value);for(const T of m)T.setAttribute("class",`language-${p}`)}if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(x=>{const k=d.createElement("style");k.innerHTML=`@import "${x}"`,d.head.appendChild(k)}),d.getElementById(r.value).setAttribute("class",t.classes)),t.dependsOnSelector!==""){const l=d.querySelector(t.dependsOnSelector);if(l!==null){const p={attributes:!0};new MutationObserver(async(k,m)=>{for(const T of k)T.type==="attributes"&&T.attributeName==="finished"&&l.getAttribute("finished")==="true"&&(m.disconnect(),await i())}).observe(l,p)}}else await i()});const u=function(d){const l=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:d}});e.value.dispatchEvent(l),e.value.setAttribute("finished","true")},i=async()=>{const d=e.value.ownerDocument;await new dt(d,t.source,t.speed,t.makeTypos,u).writeLikeAHuman(r.value,s.value)};return(d,l)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:e,class:"code-snippet"},[f.createElementVNode("div",kt,[f.createElementVNode("pre",{class:f.normalizeClass(["to-place",s.value])},[f.createElementVNode("code",{class:f.normalizeClass(h.value)},null,2)],2)]),f.createElementVNode("div",yt,[f.createElementVNode("pre",{class:f.normalizeClass(["to-write",r.value])},[f.createElementVNode("code",{class:f.normalizeClass(h.value)},null,2)],2)])],512))}}),Ct={class:"to-be-written"},At=f.defineComponent({name:"TextWriter"}),ft=Object.assign(At,{props:{source:{default:""},speed:{default:"60"},dependsOnSelector:{default:""},makeTypos:{default:!1},styles:{default:""},classes:{default:""},finished:{default:!1},restart:{default:!1}},setup(M){const t=M,e=f.ref(null),n=f.ref(""),s=f.ref(""),r=()=>{let u=Date.now().toString();return u=u.substring(u.length-4),u=btoa(u),u=u.replace(/=/g,""),u};n.value=r(),s.value="paper-"+n.value,f.onMounted(async()=>{const u=e.value.ownerDocument;if(t.styles!==""&&t.classes!==""&&(t.styles.split(",").forEach(l=>{const p=u.createElement("style");p.innerHTML=`@import "${l}"`,u.head.appendChild(p)}),u.querySelector("."+s.value).setAttribute("class",t.classes)),t.dependsOnSelector!==""){const i=u.querySelector(t.dependsOnSelector);if(i!==null){const d={attributes:!0};new MutationObserver(async(p,x)=>{for(const k of p)k.type==="attributes"&&k.attributeName==="finished"&&i.getAttribute("finished")==="true"&&(x.disconnect(),await c())}).observe(i,d)}}else await c()});const h=function(u){const i=new CustomEvent("finishedWriting",{bubbles:!0,cancellable:!0,detail:{content:u}});e.value.dispatchEvent(i),e.value.setAttribute("finished","true")},c=async()=>{const u=e.value.ownerDocument;await new dt(u,t.source,t.speed,t.makeTypos,h).writeLikeAHuman(s.value)};return(u,i)=>(f.openBlock(),f.createElementBlock("div",{ref_key:"root",ref:e,class:"text-snippet"},[f.createElementVNode("div",Ct,[f.createElementVNode("div",{class:f.normalizeClass(["to-write",s.value])},null,2)])],512))}}),St=M=>({textSpeed:M.speed,textTypos:M.makeTypos}),vt={install(M,t){M.config.globalProperties.$writerOptions=St(t),M.component("text-writer",ft),M.component("code-writer",ht)}};b.CodeWriter=ht,b.TextWriter=ft,b.VueWriterPlugin=vt,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
